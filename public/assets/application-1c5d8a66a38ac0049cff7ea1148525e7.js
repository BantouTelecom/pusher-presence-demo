function add_member(a){var b,c=c=Math.random()*20-10,d=$("<div>",{"class":"member",id:"presence_"+a.id}).css({"-moz-transform":"rotate("+c+"deg)","-webkit-transform":"rotate("+c+"deg)"});a.info.gravatar?b=$("<img>",{src:a.info.gravatar,valign:"middle"}):a.id==me?(d.addClass("no-gravatar"),b="you are here"):b=null,a.id==me&&d.addClass("me"),$("#presence").append(d.html(b))}function speak(a,b){var c=$("#presence_"+a),d=$("<div>",{"class":"bubble",text:b});c.find(".bubble").remove(),c.append(d),setTimeout(function(){d.fadeOut(function(){$(this).remove()})},3e4)}Pusher.log=function(){window.console&&window.console.log.apply(window.console,arguments)},$().ready(function(){$("#message").submit(function(){return $.post(this.action,$(this).serialize()),this.reset(),!1}),channel=socket.subscribe("presence-demo"),channel.bind("pusher:subscription_succeeded",function(a){$("#presence").empty(),a.each(add_member),console.log("Count",a.count)}),channel.bind("pusher:member_removed",function(a){$("#presence_"+a.id).remove(),console.log("Count",channel.members.count)}),channel.bind("pusher:member_added",function(a){add_member(a),console.log("Count",channel.members.count)}),channel.bind("message",function(a){speak(a.user_id,a.text)})})